<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="clubSandwich">
<title>Wald tests of multiple-constraint null hypotheses • clubSandwich</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Wald tests of multiple-constraint null hypotheses">
<meta property="og:description" content="clubSandwich">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">clubSandwich</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.5.9999</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Wald-tests-in-clubSandwich.html">Wald tests of multiple-constraint null hypotheses</a>
    <a class="dropdown-item" href="../articles/meta-analysis-with-CRVE.html">Meta-analysis with cluster-robust variance estimation</a>
    <a class="dropdown-item" href="../articles/panel-data-CRVE.html">Cluster-robust standard errors and hypothesis tests in panel data models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jepusto/clubSandwich/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="Wald-tests-in-clubSandwich_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Wald tests of multiple-constraint null hypotheses</h1>
                        <h4 data-toc-skip class="author">James E. Pustejovsky</h4>
            
            <h4 data-toc-skip class="date">2022-01-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jepusto/clubSandwich/blob/HEAD/vignettes/Wald-tests-in-clubSandwich.Rmd" class="external-link"><code>vignettes/Wald-tests-in-clubSandwich.Rmd</code></a></small>
      <div class="d-none name"><code>Wald-tests-in-clubSandwich.Rmd</code></div>
    </div>

    
    
<p>Version 0.5.0 of <code>clubSandwich</code> introduced a new syntax for <code><a href="../reference/Wald_test.html">Wald_test()</a></code>, a function for conducting tests of multiple-constraint hypotheses. In previous versions, this function was poorly documented and, consequently, probably little used. This vignette will demonstrate the new syntax.</p>
<p>For purposes of illustration, I will use the <code>STAR</code> data (available in the <code>AER</code> package), which is drawn from a randomized trial evaluating the effects of elementary school class size on student achievement. The data consist of individual-level measures for students in each of several dozen schools. For purposes of illustration, I will look at effects on math performance in first grade. Treatment conditions (the variable called <code>stark</code>) were assigned at the classroom level, and consisted of either a) a regular-size class, b) a small-size class, or c) a regular-size class but with the addition of a teacher’s aide. In all of what follows, I will cluster standard errors by school in order to allow for generalization to a super-population of schools.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://jepusto.github.io/clubSandwich/">clubSandwich</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">STAR</span>, package <span class="op">=</span> <span class="st">"AER"</span><span class="op">)</span>

<span class="co"># clean up a few variables</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">STAR</span><span class="op">$</span><span class="va">stark</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"aide"</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">STAR</span><span class="op">$</span><span class="va">schoolk</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"urban"</span>
<span class="va">STAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">STAR</span>, 
               <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">schoolidk</span><span class="op">)</span>,
               select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">schoolidk</span>, <span class="va">schoolk</span>, <span class="va">stark</span>, <span class="va">gender</span>, <span class="va">ethnicity</span>, <span class="va">math1</span>, <span class="va">lunchk</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">STAR</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      schoolidk  schoolk   stark gender ethnicity math1   lunchk</span>
<span class="co">## 1137        63    rural   small female      cauc   538 non-free</span>
<span class="co">## 1143        20 suburban   small female      afam   592 non-free</span>
<span class="co">## 1183        19    urban    aide   male      afam    NA     free</span>
<span class="co">## 1277        69    rural regular   male      cauc   584 non-free</span>
<span class="co">## 1292        79    rural   small   male      cauc   545     free</span>
<span class="co">## 1308         5    rural regular   male      cauc   553     free</span></code></pre>
<div class="section level2">
<h2 id="the-wald-test-function">The Wald test function<a class="anchor" aria-label="anchor" href="#the-wald-test-function"></a>
</h2>
<p>The <code><a href="../reference/Wald_test.html">Wald_test()</a></code> function can be used to conduct hypothesis tests that involve multiple constraints on the regression coefficients. Consider a linear model for an outcome <span class="math inline">\(Y_{ij}\)</span> regressed on a <span class="math inline">\(1 \times p\)</span> row vector of predictors <span class="math inline">\(\mathbf{x}_{ij}\)</span> (which might include a constant intercept term): <span class="math display">\[
Y_{ij} = \mathbf{x}_{ij} \boldsymbol\beta + \epsilon_{ij}
\]</span> The regression coefficient vector is <span class="math inline">\(\boldsymbol\beta\)</span>. In quite general terms, a set of constraints on the regression coefficient vector can be expressed in terms of a <span class="math inline">\(q \times p\)</span> matrix <span class="math inline">\(\mathbf{C}\)</span>, where each row of <span class="math inline">\(\mathbf{C}\)</span> corresponds to one constraint. A joint null hypothesis is then <span class="math inline">\(H_0: \mathbf{C} \boldsymbol\beta = \mathbf{0}\)</span>, where <span class="math inline">\(\mathbf{0}\)</span> is a <span class="math inline">\(q \times 1\)</span> vector of zeros.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;In &lt;span class="citation"&gt;Pustejovsky &amp;amp; Tipton (2018)&lt;/span&gt; we used a more general formulation of multiple-constraint null hypotheses, expressed as &lt;span class="math inline"&gt;\(H_0: \mathbf{C} \boldsymbol\beta = \mathbf{d}\)&lt;/span&gt; for some fixed &lt;span class="math inline"&gt;\(q \times 1\)&lt;/span&gt; vector &lt;span class="math inline"&gt;\(\mathbf{d}\)&lt;/span&gt;. In practice, it’s often possible to modify the &lt;span class="math inline"&gt;\(\mathbf{C}\)&lt;/span&gt; matrix so that &lt;span class="math inline"&gt;\(\mathbf{d}\)&lt;/span&gt; can always be set to &lt;span class="math inline"&gt;\(\mathbf{0}\)&lt;/span&gt;.&lt;/p&gt;'><sup>1</sup></a></p>
<p>Wald-type test are based on the test statistic <span class="math display">\[
Q = \left(\mathbf{C}\boldsymbol{\hat\beta}\right)' \left(\mathbf{C} \mathbf{V}^{CR} \mathbf{C}'\right)^{-1} \left(\mathbf{C}\boldsymbol{\hat\beta}\right),
\]</span> where <span class="math inline">\(\boldsymbol{\hat\beta}\)</span> is the estimated regression coefficient vector and <span class="math inline">\(\mathbf{V}^{CR}\)</span> is a cluster-robust variance matrix. If the number of clusters is sufficiently large, then the distribution of <span class="math inline">\(Q\)</span> under the null hypothesis is approximately <span class="math inline">\(\chi^2(q)\)</span>. <span class="citation">Tipton &amp; Pustejovsky (2015)</span> investigated a wide range of other approximations to the null distribution of <span class="math inline">\(Q\)</span>, many of which are included as options in <code><a href="../reference/Wald_test.html">Wald_test()</a></code>. Based on a large simulation, they (…er…we…) recommended a method called the “approximate Hotelling’s <span class="math inline">\(T^2\)</span>-Z” test, or “AHZ.” This test approximates the distribution of <span class="math inline">\(Q / q\)</span> by a <span class="math inline">\(T^2\)</span> distribution, which is a multiple of an <span class="math inline">\(F\)</span> distribution, with numerator degrees of freedom <span class="math inline">\(q\)</span> and denominator degrees of freedom based on a generalization of the Satterthwaite approximation.</p>
<p>The <code><a href="../reference/Wald_test.html">Wald_test()</a></code> function has three main arguments:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">Wald_test</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## function (obj, constraints, vcov, test = "HTZ", tidy = FALSE, </span>
<span class="co">##     ...) </span>
<span class="co">## NULL</span></code></pre>
<ul>
<li>The <code>obj</code> argument is used to specify the estimated regression model on which to perform the test,</li>
<li>the <code>constraints</code> argument is a <span class="math inline">\(\mathbf{C}\)</span> matrix expressing the set of constraints to test, and</li>
<li>the <code>vcov</code> argument is a cluster-robust variance matrix, which is used to construct the test statistic. (Alternately, <code>vcov</code> can be the type of cluster-robust variance matrix to construct, in which case it will be computed internally.)</li>
</ul>
<p>By default, <code><a href="../reference/Wald_test.html">Wald_test()</a></code> will use the HTZ small-sample approximation. Other options are available (via the <code>test</code> argument) but not recommended for routine use. The optional <code>tidy</code> argument will be demonstrated below.</p>
<div class="section level3">
<h3 id="testing-treatment-effects">Testing treatment effects<a class="anchor" aria-label="anchor" href="#testing-treatment-effects"></a>
</h3>
<p>Returning to the STAR data, let’s suppose we want to examine differences in math performance across class sizes. This can be done with a simple linear regression model, while clustering the standard errors by <code>schoolidk</code>. The estimating equation is <span class="math display">\[
\left(\text{Math}\right)_{ij} = \beta_0 + \beta_1 \left(\text{small}\right)_{ij} + \beta_2 \left(\text{aide}\right)_{ij} + e_{ij},
\]</span> which can be estimated in R as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">math1</span> <span class="op">~</span> <span class="va">stark</span>, data <span class="op">=</span> <span class="va">STAR</span><span class="op">)</span>
<span class="va">V_trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcovCR.html">vcovCR</a></span><span class="op">(</span><span class="va">lm_trt</span>, cluster <span class="op">=</span> <span class="va">STAR</span><span class="op">$</span><span class="va">schoolidk</span>, type <span class="op">=</span> <span class="st">"CR2"</span><span class="op">)</span>
<span class="fu"><a href="../reference/coef_test.html">coef_test</a></span><span class="op">(</span><span class="va">lm_trt</span>, vcov <span class="op">=</span> <span class="va">V_trt</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        Coef. Estimate   SE  t-stat d.f. (Satt) p-val (Satt) Sig.</span>
<span class="co">##  (Intercept)  531.727 2.78 191.506        59.9       &lt;0.001  ***</span>
<span class="co">##   starksmall    9.469 2.30   4.114        65.6       &lt;0.001  ***</span>
<span class="co">##    starkaide   -0.483 1.86  -0.259        65.6        0.796</span></code></pre>
<p>In this estimating equation, the coefficients <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> represent treatment effects, or differences in average math scores relative to the reference level of <code>stark</code>, which in this case is a regular-size class. The t-statistics and p-values reported by <code>coef_test</code> are separate tests of the null hypotheses that each of these coefficients are equal to zero, meaning that there is no difference between the specified treatment condition and the reference level. We might want to instead test the <em>joint</em> null hypothesis that there are no differences among <em>any</em> of the conditions. This null can be expressed by a set of multiple constraints on the parameters: <span class="math inline">\(\beta_1 = 0\)</span> and <span class="math inline">\(\beta_2 = 0\)</span>.</p>
<p>To test the null hypothesis that <span class="math inline">\(\beta_1 = \beta_2 = 0\)</span> based on the treatment effects model specification, we can use:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">C_trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">C_trt</span></code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]    0    1    0</span>
<span class="co">## [2,]    0    0    1</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_trt</span>, constraints <span class="op">=</span> <span class="va">C_trt</span>, vcov <span class="op">=</span> <span class="va">V_trt</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  test Fstat df_num df_denom  p_val sig</span>
<span class="co">##   HTZ  10.2      2     65.3 &lt;0.001 ***</span></code></pre>
<p>The result includes details about the form of <code>test</code> computed, the <span class="math inline">\(F\)</span>-statistic, the numerator and denominator degrees of freedom used to compute the reference distribution, and the <span class="math inline">\(p\)</span>-value corresponding to the specified null hypothesis. In this example, <span class="math inline">\(p = 0.000141\)</span>, so we can rule out the null hypothesis that there are no differences in math performance across conditions.</p>
<p>The representation of null hypotheses as arbitrary constraint matrices is useful for developing theory about how to test such hypotheses, but it is not all that helpful for actually running tests—constructing constraint matrices “by hand” is just too cumbersome of an exercise. Moreover, <span class="math inline">\(\mathbf{C}\)</span> matrices typically follow one of a small number of patterns. Two common use cases are a) constraining a set of <span class="math inline">\(q &gt; 1\)</span> parameters to all be equal to zero and b) constraining a set of <span class="math inline">\(q + 1\)</span> parameters to be equal to a common value. The <code>clubSandwich</code> package now includes a set of helper functions to create constraint matrices for these common use cases.</p>
</div>
<div class="section level3">
<h3 id="constrain_zero">
<code>constrain_zero()</code><a class="anchor" aria-label="anchor" href="#constrain_zero"></a>
</h3>
<p>To constrain a set of <span class="math inline">\(q\)</span> regression coefficients to all be equal to zero, the simplest form of the <span class="math inline">\(\mathbf{C}\)</span> matrix would consist of a set of <span class="math inline">\(q\)</span> rows, where a single entry in each row would be equal to 1 and the remaining entries would all be zero. For the <code>lm_trt</code> model, the C matrix would look like this: <span class="math display">\[
\mathbf{C} = \left[\begin{array}{ccc} 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 1 \end{array} \right],
\]</span> so that <span class="math display">\[
\mathbf{C}\boldsymbol\beta = \left[\begin{array}{ccc} 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 1 \end{array} \right] \left[\begin{array}{c} \beta_0 \\ \beta_1 \\ \beta_2 \end{array} \right] = \left[\begin{array}{c} \beta_1 \\ \beta_2 \end{array} \right],
\]</span> which is set equal to <span class="math inline">\(\left[\begin{array}{c} 0 \\ 0 \end{array} \right]\)</span>.</p>
<p>The <code><a href="../reference/constraint_matrices.html">constrain_zero()</a></code> function will create matrices like this automatically. The function takes two main arguments:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">constrain_zero</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## function (constraints, coefs, reg_ex = FALSE) </span>
<span class="co">## NULL</span></code></pre>
<ul>
<li>The <code>constraints</code> argument is used to specify <em>which</em> coefficients in a regression model to set equal to zero.</li>
<li>The <code>coefs</code> argument is the set of estimated regression coefficients, for which to calculate the constraints.</li>
</ul>
<p>Constraints can be specified by position index, by name, or via a regular expression. To test the joint null hypothesis that average math performance is equal across the three treatment conditions, we need to constrain the second and third coefficients to zero:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, coefs <span class="op">=</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_trt</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]    0    1    0</span>
<span class="co">## [2,]    0    0    1</span></code></pre>
<p>Or equivalently:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"starksmall"</span>,<span class="st">"starkaide"</span><span class="op">)</span>, coefs <span class="op">=</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_trt</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]    0    1    0</span>
<span class="co">## [2,]    0    0    1</span></code></pre>
<p>or</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="st">"^stark"</span>, coefs <span class="op">=</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_trt</span><span class="op">)</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]    0    1    0</span>
<span class="co">## [2,]    0    0    1</span></code></pre>
<p>Note that if <code>constraints</code> is a regular expression, then the <code>reg_ex</code> argument needs to be set to <code>TRUE</code>.</p>
<p>The result of <code><a href="../reference/constraint_matrices.html">constrain_zero()</a></code> can then be fed into the <code><a href="../reference/Wald_test.html">Wald_test()</a></code> function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">C_trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, coefs <span class="op">=</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_trt</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_trt</span>, constraints <span class="op">=</span> <span class="va">C_trt</span>, vcov <span class="op">=</span> <span class="va">V_trt</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  test Fstat df_num df_denom  p_val sig</span>
<span class="co">##   HTZ  10.2      2     65.3 &lt;0.001 ***</span></code></pre>
<p>To reduce redundancy in the syntax, we can also omit the <code>coefs</code> argument to <code>constrain_zero</code>, so long as we call it inside of <code>Wald_test</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;How does this work? If we omit the &lt;code&gt;coefs&lt;/code&gt; argument, &lt;code&gt;&lt;a href="../reference/constraint_matrices.html"&gt;constrain_zero()&lt;/a&gt;&lt;/code&gt; acts as a functional, by returning a function equivalent to &lt;code&gt;function(coefs) constrain_zero(constraints, coefs = coefs)&lt;/code&gt;. If this function is fed into the &lt;code&gt;constraints&lt;/code&gt; argument of &lt;code&gt;&lt;a href="../reference/Wald_test.html"&gt;Wald_test()&lt;/a&gt;&lt;/code&gt;, &lt;code&gt;&lt;a href="../reference/Wald_test.html"&gt;Wald_test()&lt;/a&gt;&lt;/code&gt; recognizes that it is a function and evaluates the function with &lt;code&gt;coef(obj)&lt;/code&gt;. It’s a kinda-sorta hacky substitute for lazy evaluation. If you have suggestions for how to do this more elegantly, please send them my way.&lt;/p&gt;'><sup>2</sup></a>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_trt</span>, constraints <span class="op">=</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, vcov <span class="op">=</span> <span class="va">V_trt</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  test Fstat df_num df_denom  p_val sig</span>
<span class="co">##   HTZ  10.2      2     65.3 &lt;0.001 ***</span></code></pre>
</div>
<div class="section level3">
<h3 id="constrain_equal">
<code>constrain_equal()</code><a class="anchor" aria-label="anchor" href="#constrain_equal"></a>
</h3>
<p>Another common type of constraints involve setting a set of <span class="math inline">\(q + 1\)</span> regression coefficients to be all equal to a common (but unknown) value (<span class="math inline">\(q + 1\)</span> because it takes <span class="math inline">\(q\)</span> constraints to do this). There are many equivalent ways to express such a set of constraints in terms of a <span class="math inline">\(\mathbf{C}\)</span> matrix. One fairly simple form consists of a set of <span class="math inline">\(q\)</span> rows, where the entry corresponding to one of the coefficients of interest is equal to -1 and the entry corresponding to another coefficient of interest is equal to 1.</p>
<p>To see how this works, let’s look at a different way of parameterizing our simple model for the STAR data, by using separate intercepts for each treatment condition. The estimating equation would then be <span class="math display">\[
\left(\text{Math}\right)_{ij} = \beta_0 \left(\text{regular}\right)_{ij} + \beta_1 \left(\text{small}\right)_{ij} + \beta_2 \left(\text{aide}\right)_{ij} + e_{ij}.
\]</span> This model can be estimated in R by dropping the intercept term:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">math1</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">stark</span>, data <span class="op">=</span> <span class="va">STAR</span><span class="op">)</span>
<span class="va">V_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcovCR.html">vcovCR</a></span><span class="op">(</span><span class="va">lm_sep</span>, cluster <span class="op">=</span> <span class="va">STAR</span><span class="op">$</span><span class="va">schoolidk</span>, type <span class="op">=</span> <span class="st">"CR2"</span><span class="op">)</span>
<span class="fu"><a href="../reference/coef_test.html">coef_test</a></span><span class="op">(</span><span class="va">lm_sep</span>, vcov <span class="op">=</span> <span class="va">V_sep</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##         Coef. Estimate   SE t-stat d.f. (Satt) p-val (Satt) Sig.</span>
<span class="co">##  starkregular      532 2.78    192        59.9       &lt;0.001  ***</span>
<span class="co">##    starksmall      541 2.89    187        65.0       &lt;0.001  ***</span>
<span class="co">##     starkaide      531 2.72    195        64.3       &lt;0.001  ***</span></code></pre>
<p>In this parameterization, the coefficients <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span>, and <span class="math inline">\(\beta_2\)</span> represent the average math performance levels of students in each of the treatment conditions. The t-tests and p-values now have a very different interpretation because they pertain to the null hypothesis that the average performance level for a given condition is equal to zero. With this separate-intercepts model, the joint null hypothesis that performance levels are equal across conditions amounts to constraining the intercepts to be equal to each other: <span class="math inline">\(\beta_0 = \beta_1\)</span> and <span class="math inline">\(\beta_0 = \beta_2\)</span> (note that we don’t need the constraint <span class="math inline">\(\beta_1 = \beta_2\)</span> because it is implied by the first two).</p>
<p>For the <code>lm_sep</code> model, which has separate intercepts <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span>, and <span class="math inline">\(\beta_2\)</span>, the C matrix would look like this: <span class="math display">\[
\mathbf{C} = \left[\begin{array}{ccc} -1 &amp; 1 &amp; 0 \\ -1 &amp; 0 &amp; 1 \end{array} \right],
\]</span> so that <span class="math display">\[
\mathbf{C}\boldsymbol\beta = \left[\begin{array}{ccc} -1 &amp; 1 &amp; 0 \\ -1 &amp; 0 &amp; 1 \end{array} \right] \left[\begin{array}{c} \beta_0 \\ \beta_1 \\ \beta_2 \end{array} \right] = \left[\begin{array}{c} \beta_1 - \beta_0 \\ \beta_2 - \beta_0 \end{array} \right],
\]</span> which is set equal to <span class="math inline">\(\left[\begin{array}{c} 0 \\ 0 \end{array} \right]\)</span>.</p>
<p>The <code><a href="../reference/constraint_matrices.html">constrain_equal()</a></code> function will create matrices like this automatically, given a set of coefficients to constrain. The syntax is identical to <code><a href="../reference/constraint_matrices.html">constrain_zero()</a></code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/args.html" class="external-link">args</a></span><span class="op">(</span><span class="va">constrain_equal</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## function (constraints, coefs, reg_ex = FALSE) </span>
<span class="co">## NULL</span></code></pre>
<p>To test the joint null hypothesis that average math performance is equal across the three treatment conditions, we can constrain all three coefficients of <code>lm_sep</code> to be equal:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/constraint_matrices.html">constrain_equal</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, coefs <span class="op">=</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_sep</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]   -1    1    0</span>
<span class="co">## [2,]   -1    0    1</span></code></pre>
<p>Or equivalently:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/constraint_matrices.html">constrain_equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"starkregular"</span>,<span class="st">"starksmall"</span>,<span class="st">"starkaide"</span><span class="op">)</span>, coefs <span class="op">=</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_sep</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]   -1    1    0</span>
<span class="co">## [2,]   -1    0    1</span></code></pre>
<p>or</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/constraint_matrices.html">constrain_equal</a></span><span class="op">(</span><span class="st">"^stark"</span>, coefs <span class="op">=</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_sep</span><span class="op">)</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]   -1    1    0</span>
<span class="co">## [2,]   -1    0    1</span></code></pre>
<p>Just as with <code>constrain_zero</code>, if <code>constraints</code> is a regular expression, then the <code>reg_ex</code> argument needs to be set to <code>TRUE</code>.</p>
<p>This constraint matrix can then be fed into <code><a href="../reference/Wald_test.html">Wald_test()</a></code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">C_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_equal</a></span><span class="op">(</span><span class="st">"^stark"</span>, coefs <span class="op">=</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_sep</span><span class="op">)</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_sep</span>, constraints <span class="op">=</span> <span class="va">C_sep</span>, vcov <span class="op">=</span> <span class="va">V_sep</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  test Fstat df_num df_denom  p_val sig</span>
<span class="co">##   HTZ  10.2      2     65.3 &lt;0.001 ***</span></code></pre>
<p>or equivalently:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_sep</span>, constraints <span class="op">=</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_equal</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, vcov <span class="op">=</span> <span class="va">V_sep</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  test Fstat df_num df_denom  p_val sig</span>
<span class="co">##   HTZ  10.2      2     65.3 &lt;0.001 ***</span></code></pre>
<p>Note that these test results are exactly equal to the tests based on <code>lm_trt</code> with <code><a href="../reference/constraint_matrices.html">constrain_zero()</a></code>. They’re algebraically equivalent—just different ways of parameterizing the same model and constraints.</p>
</div>
</div>
<div class="section level2">
<h2 id="testing-an-interaction">Testing an interaction<a class="anchor" aria-label="anchor" href="#testing-an-interaction"></a>
</h2>
<p>Let’s now consider how these functions can be applied in a more complex model. Suppose that we are interested in understanding whether the effect of being in a small class is consistent across schools in different areas, where areas are categorized as urban, suburban, or rural. To answer this question, we need to test for an interaction between urbanicity and treatment condition. One estimating equation that would let us examine this question is: <span class="math display">\[
\begin{aligned}
\left(\text{Math}\right)_{ij} &amp;= \beta_0 + \beta_1 \left(\text{suburban}\right)_{ij} + \beta_2 \left(\text{rural}\right)_{ij} \\
&amp; \quad + \beta_3 \left(\text{small}\right)_{ij} + \beta_4 \left(\text{aide}\right)_{ij} \\
&amp; \quad\quad + \beta_5 \left(\text{small}\right)(\text{suburban})_{ij} + \beta_6 \left(\text{aide}\right)(\text{suburban})_{ij} \\
&amp; \quad\quad\quad + \beta_{7} \left(\text{small}\right)(\text{rural})_{ij} + \beta_{8} \left(\text{aide}\right)(\text{rural})_{ij} \\
&amp; \quad\quad\quad\quad + \mathbf{x}_{ij} \boldsymbol\gamma  + e_{ij},
\end{aligned}
\]</span> where <span class="math inline">\(\mathbf{x}_{ij}\)</span> is a row vector of student characteristics, included just to make the regression look fancier. In this specification, <span class="math inline">\(\beta_3\)</span> and <span class="math inline">\(\beta_4\)</span> represent the effects of being in a small class or aide class, compared to being in a regular class, but <em>only for the reference level of urbanicity</em>—in this case, urban schools. The coefficients <span class="math inline">\(\beta_5, \beta_6, \beta_7, \beta_8\)</span> all represent <em>interactions</em> between treatment condition and urbanicity. Here’s the model, estimated in R:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_urbanicity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">math1</span> <span class="op">~</span> <span class="va">schoolk</span> <span class="op">*</span> <span class="va">stark</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">ethnicity</span> <span class="op">+</span> <span class="va">lunchk</span>, data <span class="op">=</span> <span class="va">STAR</span><span class="op">)</span>
<span class="va">V_urbanicity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcovCR.html">vcovCR</a></span><span class="op">(</span><span class="va">lm_urbanicity</span>, cluster <span class="op">=</span> <span class="va">STAR</span><span class="op">$</span><span class="va">schoolidk</span>, type <span class="op">=</span> <span class="st">"CR2"</span><span class="op">)</span>
<span class="fu"><a href="../reference/coef_test.html">coef_test</a></span><span class="op">(</span><span class="va">lm_urbanicity</span>, vcov <span class="op">=</span> <span class="va">V_urbanicity</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                       Coef. Estimate    SE  t-stat d.f. (Satt) p-val (Satt)</span>
<span class="co">##                 (Intercept)   542.62  5.91 91.8599       21.70       &lt;0.001</span>
<span class="co">##             schoolksuburban     2.77  6.76  0.4100       28.35       0.6849</span>
<span class="co">##                schoolkrural     1.03  6.38  0.1616       30.74       0.8727</span>
<span class="co">##                  starksmall     9.42  4.56  2.0649       17.10       0.0544</span>
<span class="co">##                   starkaide    -4.27  2.17 -1.9631       16.73       0.0665</span>
<span class="co">##                genderfemale     2.14  1.20  1.7773       67.14       0.0800</span>
<span class="co">##               ethnicityafam   -16.79  4.19 -4.0026       34.94       &lt;0.001</span>
<span class="co">##              ethnicityasian    13.19 11.02  1.1963        6.23       0.2751</span>
<span class="co">##           ethnicityhispanic    39.23 20.62  1.9028        1.01       0.3067</span>
<span class="co">##              ethnicityother     8.86 18.78  0.4720        3.02       0.6690</span>
<span class="co">##                  lunchkfree   -19.37  2.04 -9.4848       57.38       &lt;0.001</span>
<span class="co">##  schoolksuburban:starksmall     3.03  6.39  0.4746       28.94       0.6386</span>
<span class="co">##     schoolkrural:starksmall    -0.31  5.58 -0.0555       34.04       0.9560</span>
<span class="co">##   schoolksuburban:starkaide     5.10  3.72  1.3711       28.64       0.1810</span>
<span class="co">##      schoolkrural:starkaide     8.16  3.16  2.5857       34.30       0.0141</span>
<span class="co">##  Sig.</span>
<span class="co">##   ***</span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##     .</span>
<span class="co">##     .</span>
<span class="co">##     .</span>
<span class="co">##   ***</span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##   ***</span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##     *</span></code></pre>
<p>With this specification, there are several different null hypotheses that we might want to test. For one, perhaps we want to see if there is <em>any</em> variation in treatment effects across different levels of urbanicity. This can be expressed in the null hypothesis that all four interaction terms are zero, or <span class="math inline">\(H_{0A}: \beta_5 = \beta_6 = \beta_7 = \beta_8 = 0\)</span>. With Wald test:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_urbanicity</span>, 
          constraints <span class="op">=</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="st">"schoolk.+:stark"</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
          vcov <span class="op">=</span> <span class="va">V_urbanicity</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  test Fstat df_num df_denom p_val sig</span>
<span class="co">##   HTZ  1.96      4     37.5 0.121</span></code></pre>
<p>Another possibility is that we might want to focus on variation in the effect of being in a small class or regular class, while ignoring whatever is going on in the aide class condition. Here, the null hypothesis would be simply <span class="math inline">\(H_{0B}: \beta_5 = \beta_6 = 0\)</span>, tested as:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_urbanicity</span>, 
          constraints <span class="op">=</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="st">"schoolk.+:starksmall"</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
          vcov <span class="op">=</span> <span class="va">V_urbanicity</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  test Fstat df_num df_denom p_val sig</span>
<span class="co">##   HTZ 0.189      2     34.5 0.828</span></code></pre>
<div class="section level3">
<h3 id="lists-of-constraints">Lists of constraints<a class="anchor" aria-label="anchor" href="#lists-of-constraints"></a>
</h3>
<p>In models like the urbanicity-by-treatment interaction specification, we may need to run multiple tests on the same estimating equation. This can be accomplished with <code>Wald_test</code> by providing a <em>list</em> of constraints to the <code>constraints</code> argument. For example, we could test the hypotheses described above by creating a list of several constraint matrices and then passing it to <code>Wald_test</code>:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">C_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  `Any interaction` <span class="op">=</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="st">"schoolk.+:stark"</span>, 
                                     <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_urbanicity</span><span class="op">)</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
  `Small vs regular` <span class="op">=</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="st">"schoolk.+:starksmall"</span>, 
                                      <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_urbanicity</span><span class="op">)</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_urbanicity</span>, 
          constraints <span class="op">=</span> <span class="va">C_list</span>,
          vcov <span class="op">=</span> <span class="va">V_urbanicity</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $`Any interaction`</span>
<span class="co">##  test Fstat df_num df_denom p_val sig</span>
<span class="co">##   HTZ  1.96      4     37.5 0.121    </span>
<span class="co">## </span>
<span class="co">## $`Small vs regular`</span>
<span class="co">##  test Fstat df_num df_denom p_val sig</span>
<span class="co">##   HTZ 0.189      2     34.5 0.828</span></code></pre>
<p>Setting the option <code>tidy = TRUE</code> will arrange the output of all the tests into a single data frame:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_urbanicity</span>, 
          constraints <span class="op">=</span> <span class="va">C_list</span>,
          vcov <span class="op">=</span> <span class="va">V_urbanicity</span>, 
          tidy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        hypothesis test Fstat df_num df_denom p_val sig</span>
<span class="co">##   Any interaction  HTZ 1.960      4     37.5 0.121    </span>
<span class="co">##  Small vs regular  HTZ 0.189      2     34.5 0.828</span></code></pre>
<p>The list of constraints can also be created inside <code>Wald_test</code>, so that the <code>coefs</code> argument can be omitted from <code><a href="../reference/constraint_matrices.html">constrain_zero()</a></code>:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span>
  <span class="va">lm_urbanicity</span>, 
  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    `Any interaction` <span class="op">=</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="st">"schoolk.+:stark"</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    `Small vs regular` <span class="op">=</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_zero</a></span><span class="op">(</span><span class="st">"schoolk.+:starksmall"</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">)</span>,
  vcov <span class="op">=</span> <span class="va">V_urbanicity</span>, 
  tidy <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        hypothesis test Fstat df_num df_denom p_val sig</span>
<span class="co">##   Any interaction  HTZ 1.960      4     37.5 0.121    </span>
<span class="co">##  Small vs regular  HTZ 0.189      2     34.5 0.828</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="pairwise-t-tests">Pairwise t-tests<a class="anchor" aria-label="anchor" href="#pairwise-t-tests"></a>
</h2>
<p>The <code>clubSandwich</code> package also provides a further convenience function, <code><a href="../reference/constraint_matrices.html">constrain_pairwise()</a></code> that can be used in combination with <code><a href="../reference/Wald_test.html">Wald_test()</a></code> to conduct pairwise comparisons among a set of regression coefficients. This function differs from the other two <code>constrain_*()</code> functions because it returns a <em>list</em> of constraint matrices, each of which corresponds to a single linear combination of covariates. Specifically, the <code><a href="../reference/constraint_matrices.html">constrain_pairwise()</a></code> function provides a list of constraints that represent the differences between every possible pair among a specified set of coefficients. The syntax is very similar to the other <code>constrain_*()</code> functions.</p>
<p>To demonstrate, consider the separate-intercepts specification of the simpler regression model:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/coef_test.html">coef_test</a></span><span class="op">(</span><span class="va">lm_sep</span>, vcov <span class="op">=</span> <span class="va">V_sep</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##         Coef. Estimate   SE t-stat d.f. (Satt) p-val (Satt) Sig.</span>
<span class="co">##  starkregular      532 2.78    192        59.9       &lt;0.001  ***</span>
<span class="co">##    starksmall      541 2.89    187        65.0       &lt;0.001  ***</span>
<span class="co">##     starkaide      531 2.72    195        64.3       &lt;0.001  ***</span></code></pre>
<p>This specification is nice because it lets us simply read off the average outcomes for each group. However, we will naturally also want to know about whether there are differences between the groups, so we’ll want to compare the small-class condition to the regular-size class condition, the aide condition to the regular-size class condition, and the small-class condition to the aide condition. Thus, we’ll want comparisons among all three coefficients:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">C_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_pairwise</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, coefs <span class="op">=</span> <span class="fu"><a href="https://wviechtb.github.io/metafor/reference/coef.rma.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_sep</span><span class="op">)</span><span class="op">)</span>
<span class="va">C_pairs</span></code></pre></div>
<pre><code><span class="co">## $`starksmall - starkregular`</span>
<span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]   -1    1    0</span>
<span class="co">## </span>
<span class="co">## $`starkaide - starkregular`</span>
<span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]   -1    0    1</span>
<span class="co">## </span>
<span class="co">## $`starkaide - starksmall`</span>
<span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]    0   -1    1</span></code></pre>
<p>Feeding these constraints into <code><a href="../reference/Wald_test.html">Wald_test()</a></code> gives us significance tests for each pair:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_sep</span>, constraints <span class="op">=</span> <span class="va">C_pairs</span>, vcov <span class="op">=</span> <span class="va">V_sep</span>, tidy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                 hypothesis test   Fstat df_num df_denom  p_val sig</span>
<span class="co">##  starksmall - starkregular  HTZ 16.9238      1     65.6 &lt;0.001 ***</span>
<span class="co">##   starkaide - starkregular  HTZ  0.0673      1     65.6  0.796    </span>
<span class="co">##     starkaide - starksmall  HTZ 17.8137      1     66.9 &lt;0.001 ***</span></code></pre>
<p>The first two of these tests are equivalent to the tests of the treatment effect coefficients in the other parameterization of the model. Indeed, the denominator degrees of freedom are identical to the results of <code>coef_test(lm_trt, vcov = V_trt)</code>; the <code>Fstat</code>s here are equal to the squared t-statistics from the first model:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coef_test.html">coef_test</a></span><span class="op">(</span><span class="va">lm_trt</span>, vcov <span class="op">=</span> <span class="va">V_trt</span><span class="op">)</span><span class="op">$</span><span class="va">tstat</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>
<span class="va">F_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_sep</span>, constraints <span class="op">=</span> <span class="va">C_pairs</span>, vcov <span class="op">=</span> <span class="va">V_sep</span>, tidy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">Fstat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">t_stats</span><span class="op">^</span><span class="fl">2</span>, <span class="va">F_stats</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<p>It is important to note that the p-values from the pairwise comparisons are <em>not</em> corrected for multiplicity.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Options to include multiplicity corrections (Bonferroni, Holm, Benjamini-Hochberg, etc.) might be included in a &lt;a href="https://github.com/jepusto/clubSandwich/issues/33" class="external-link"&gt;future release&lt;/a&gt;. Reach out if this is of interest to you.&lt;/p&gt;'><sup>3</sup></a> For now, please correct-your-own using <code><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust()</a></code> or your preferred method.</p>
<p>Pairwise comparisons might also be of use in the model with treatment-by-urbanicity interactions. Here’s the model results again:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/coef_test.html">coef_test</a></span><span class="op">(</span><span class="va">lm_urbanicity</span>, vcov <span class="op">=</span> <span class="va">V_urbanicity</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                       Coef. Estimate    SE  t-stat d.f. (Satt) p-val (Satt)</span>
<span class="co">##                 (Intercept)   542.62  5.91 91.8599       21.70       &lt;0.001</span>
<span class="co">##             schoolksuburban     2.77  6.76  0.4100       28.35       0.6849</span>
<span class="co">##                schoolkrural     1.03  6.38  0.1616       30.74       0.8727</span>
<span class="co">##                  starksmall     9.42  4.56  2.0649       17.10       0.0544</span>
<span class="co">##                   starkaide    -4.27  2.17 -1.9631       16.73       0.0665</span>
<span class="co">##                genderfemale     2.14  1.20  1.7773       67.14       0.0800</span>
<span class="co">##               ethnicityafam   -16.79  4.19 -4.0026       34.94       &lt;0.001</span>
<span class="co">##              ethnicityasian    13.19 11.02  1.1963        6.23       0.2751</span>
<span class="co">##           ethnicityhispanic    39.23 20.62  1.9028        1.01       0.3067</span>
<span class="co">##              ethnicityother     8.86 18.78  0.4720        3.02       0.6690</span>
<span class="co">##                  lunchkfree   -19.37  2.04 -9.4848       57.38       &lt;0.001</span>
<span class="co">##  schoolksuburban:starksmall     3.03  6.39  0.4746       28.94       0.6386</span>
<span class="co">##     schoolkrural:starksmall    -0.31  5.58 -0.0555       34.04       0.9560</span>
<span class="co">##   schoolksuburban:starkaide     5.10  3.72  1.3711       28.64       0.1810</span>
<span class="co">##      schoolkrural:starkaide     8.16  3.16  2.5857       34.30       0.0141</span>
<span class="co">##  Sig.</span>
<span class="co">##   ***</span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##     .</span>
<span class="co">##     .</span>
<span class="co">##     .</span>
<span class="co">##   ***</span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##   ***</span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##      </span>
<span class="co">##     *</span></code></pre>
<p>Suppose that we are interested in the effect of small versus regular size classes, and in particular whether this effect varies across schools in different areas. The coefficients on <code>schoolksuburban:starksmall</code> and <code>schoolkrural:starksmall</code> already give us the differences in treatment effects between suburban schools versus urban schools and between rural schools versus urban schools. The difference between these coefficients gives us the difference in treatment effects between suburban schools and rural schools. We can look at all three of these contrasts using <code><a href="../reference/constraint_matrices.html">constrain_pairwise()</a></code> by setting the option <code>with_zero = TRUE</code>:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Wald_test.html">Wald_test</a></span><span class="op">(</span><span class="va">lm_urbanicity</span>, 
          constraints <span class="op">=</span> <span class="fu"><a href="../reference/constraint_matrices.html">constrain_pairwise</a></span><span class="op">(</span><span class="st">":starksmall"</span>, reg_ex <span class="op">=</span> <span class="cn">TRUE</span>, with_zero <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
          vcov <span class="op">=</span> <span class="va">V_urbanicity</span>,
          tidy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                                            hypothesis test   Fstat df_num</span>
<span class="co">##                            schoolksuburban:starksmall  HTZ 0.22526      1</span>
<span class="co">##                               schoolkrural:starksmall  HTZ 0.00308      1</span>
<span class="co">##  schoolkrural:starksmall - schoolksuburban:starksmall  HTZ 0.36471      1</span>
<span class="co">##  df_denom p_val sig</span>
<span class="co">##      28.9 0.639    </span>
<span class="co">##      34.0 0.956    </span>
<span class="co">##      24.4 0.551</span></code></pre>
<p>Again, the results of the first two tests are identical to the t-tests reported in <code><a href="../reference/coef_test.html">coef_test()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="remark">Remark<a class="anchor" aria-label="anchor" href="#remark"></a>
</h2>
<p>All of the preceding examples were based on ordinary linear regression models with clustered standard errors. However, <code><a href="../reference/Wald_test.html">Wald_test()</a></code> and its helper functions all work identically for all of the other models with supporting <code>clubSandwich</code> methods, including <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">nlme::lme()</a></code>, <code><a href="https://rdrr.io/pkg/nlme/man/gls.html" class="external-link">nlme::gls()</a></code>, <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code>, <code><a href="https://wviechtb.github.io/metafor/reference/rma.uni.html" class="external-link">rma.uni()</a></code>, <code><a href="https://wviechtb.github.io/metafor/reference/rma.mv.html" class="external-link">rma.mv()</a></code>, and <code><a href="https://rdrr.io/pkg/robumeta/man/robu.html" class="external-link">robu()</a></code>, among others.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-pustejovsky2018small">
<p>Pustejovsky, J. E., &amp; Tipton, E. (2018). Small-Sample Methods for Cluster-Robust Variance Estimation and Hypothesis Testing in Fixed Effects Models. <em>Journal of Business &amp; Economic Statistics</em>, <em>36</em>(4), 672–683. <a href="https://doi.org/10.1080/07350015.2016.1247004" class="external-link">https://doi.org/10.1080/07350015.2016.1247004</a></p>
</div>
<div id="ref-tipton2015small">
<p>Tipton, E., &amp; Pustejovsky, J. E. (2015). Small-sample adjustments for tests of moderators and model fit using robust variance estimation in meta-regression. <em>Journal of Educational and Behavioral Statistics</em>, <em>40</em>(6), 604–634. <a href="https://doi.org/10.3102/1076998615606099" class="external-link">https://doi.org/10.3102/1076998615606099</a></p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by James Pustejovsky.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
